import{j as s}from"./vendor-gzd0YkcT.js";import{auth as u,db as l}from"./firebase-jggN8PZ1.js";import{o as U,e as z,f,d as m,g as A,q as P,w as R,c as T,h as x,i as j,u as S,j as N,s as b,b as y,k as L}from"./firebase-X7xaP-Jv.js";import{d as p,h as n,M as c,g as $,s as C}from"./main-PaQvqqIh.js";import{personal as I}from"./header-CsnopHpl.js";import"./main-dTXxXa1j.js";const o={db:"smiles",rol:"smile"},v={"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña débil","auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Email no válido","auth/missing-email":"Usuario no registrado","auth/too-many-requests":"Demasiados intentos"},k={regEmail:[i=>i.toLowerCase().trim(),i=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(i)||"Email inválido"],regUsuario:[i=>i.toLowerCase().replace(/[^a-z0-9_]/g,"").trim(),i=>i.length>=4||"Mínimo 4 caracteres"],regNombre:[i=>i.trim(),i=>i.length>0||"Ingresa tu nombre"],regApellidos:[i=>i.trim(),i=>i.length>0||"Ingresa tus apellidos"],regPassword:[i=>i,i=>i.length>=6||"Mínimo 6 caracteres"],regPassword1:[i=>i,i=>i===s("#regPassword").val()||"No coinciden"]},d=(i,a,e,t,w=!1)=>`<div class="wilg_grupo"><i class="fas fa-${i}"></i><input type="${a}" id="${e}" placeholder="${t}" autocomplete="off">${w?'<i class="fas fa-eye wilg_ojo"></i>':""}</div>`,V={login:()=>`
    <div class="wilg_head">
      <div class="wilg_logo"><img src="./smile.avif" alt="Awonbe"></div>
      <h2>Bienvenido</h2><p>Inicia sesión en tu cuenta</p>
    </div>
    ${d("envelope","text","email","Email o usuario")}
    ${d("lock","password","password","Contraseña",!0)}
    <button type="button" id="Login" class="wilg_btn inactivo"><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</button>
    <div class="wilg_links">
      
      
    </div>`,registrar:()=>`
    <div class="wilg_head">
      <div class="wilg_logo"><img src="./smile.avif" alt="Awonbe"></div>
      <h2>Crear Cuenta</h2><p>Únete a la comunidad</p>
    </div>
    <div class="wilg_grid">
      ${[["envelope","email","regEmail","Email"],["user","text","regUsuario","Usuario"],["user-tie","text","regNombre","Nombre"],["user-tie","text","regApellidos","Apellidos"]].map(([i,a,e,t])=>d(i,a,e,t)).join("")}
      ${d("lock","password","regPassword","Contraseña",!0)}
      ${d("lock","password","regPassword1","Confirmar contraseña",!0)}
    </div>
    <div class="wilg_check">
      <label><input type="checkbox" id="regTerminos">
      <span>Acepto los <a href="/terminos.html" target="_blank">términos y condiciones</a></span></label>
    </div>
    <button type="button" id="Registrar" class="wilg_btn inactivo"><i class="fas fa-user-plus"></i> Registrarme</button>
    <div class="wilg_links"><span class="wilg_log"><i class="fas fa-arrow-left"></i> Ya tengo cuenta</span></div>`,restablecer:()=>`
    <div class="wilg_head">
      <div class="wilg_logo wilg_logo_sm"><img src="./smile.avif" alt="Awonbe"></div>
      <h2>Restablecer</h2><p>Te enviaremos un enlace a tu email</p>
    </div>
    ${d("envelope","text","recEmail","Email o usuario")}
    <button type="button" id="Recuperar" class="wilg_btn inactivo"><i class="fas fa-paper-plane"></i> Enviar enlace</button>
    <div class="wilg_links"><span class="wilg_log"><i class="fas fa-arrow-left"></i> Volver</span></div>`},E=()=>{s("#wimain").html('<div class="wilg_wrap"><div class="wilg_card"><form id="liForm"></form></div></div>'),g("login")},g=i=>{s("#liForm").html(V[i]()).attr("data-vista",i),s("#liForm input:first").focus()},r=i=>s(`#${i}`).val().trim(),_=async i=>{if(i.includes("@"))return i;const a=await f(m(l,o.db,i));if(!a.exists())throw new Error("Usuario no encontrado");return a.data().email},h=async i=>{C("wiSmile",i,24),i?.tema&&i.tema!==localStorage.wiTema&&s(`.tema[data-ths="${i.tema}"]`).trigger("click"),I(i)};s(document).on("click.wi",".wilg_ojo",function(){const i=s(this).siblings("input");i.attr("type",i.attr("type")==="password"?"text":"password"),s(this).toggleClass("fa-eye fa-eye-slash")}).on("input.wi","#email,#recEmail,#regEmail,#regUsuario",function(){s(this).val(s(this).val().toLowerCase())}).on("click.wi",".wilg_reg",()=>g("registrar")).on("click.wi",".wilg_rec",()=>g("restablecer")).on("click.wi",".wilg_log",()=>g("login")).on("input.wi keyup.wi","#password",i=>{s("#Login").removeClass("inactivo"),i.key==="Enter"&&s("#Login").click()}).on("input.wi keyup.wi","#regPassword1",i=>{s("#Registrar").removeClass("inactivo"),i.key==="Enter"&&s("#Registrar").click()}).on("input.wi keyup.wi","#recEmail",i=>{s("#Recuperar").removeClass("inactivo"),i.key==="Enter"&&s("#Recuperar").click()}).on("blur.wi",Object.keys(k).map(i=>`#${i}`).join(","),function(){const[i,a]=k[this.id],e=i(s(this).val());s(this).val(e);const t=a(e);t!==!0&&p(this,t,"error",2500)}).on("blur.wi","#regUsuario",async function(){const i=r("regUsuario");if(i.length<3)return;const a=!(await f(m(l,o.db,i))).exists();s(this).data("ok",a),p(this,`Usuario ${a?"disponible ✅":"no disponible ❌"}`,a?"success":"error",3e3)}).on("blur.wi","#regEmail",async function(){const i=r("regEmail");if(!i.includes("@"))return;const a=(await A(P(T(l,o.db),R("email","==",i)))).empty;s(this).data("ok",a),p(this,`Email ${a?"disponible ✅":"no disponible ❌"}`,a?"success":"error",3e3)}).on("click.wi","#Login",async function(){n(this,!0,"Iniciando");try{await x(u,await _(r("email")),r("password"));const i=(await f(m(l,o.db,u.currentUser.displayName||r("email")))).data();await h(i)}catch(i){c(v[i.code]||i.message,"error")}finally{n(this,!1)}}).on("click.wi","#Registrar",async function(){const a=[[!s("#regTerminos").is(":checked"),"#regTerminos","Acepta los términos"],[!s("#regUsuario").data("ok"),"#regUsuario","Verifica el usuario"],[!s("#regEmail").data("ok"),"#regEmail","Verifica el email"]].find(([e])=>e);if(a)return p(s(a[1])[0],a[2],"error",2500);n(this,!0,"Registrando");try{const e={email:r("regEmail"),usuario:r("regUsuario"),nombre:r("regNombre"),apellidos:r("regApellidos"),password:r("regPassword")},{user:t}=await j(u,e.email,e.password);await Promise.all([S(t,{displayName:e.usuario}),N(t)]);const w={usuario:e.usuario,email:e.email,nombre:e.nombre,apellidos:e.apellidos,rol:o.rol,uid:t.uid,terminos:!0,tema:localStorage.wiTema};await b(m(l,o.db,e.usuario),{...w,creado:y()}),await h(w),c("✅ Cuenta creada. Verifica tu email","success")}catch(e){c(v[e.code]||e.message,"error")}finally{n(this,!1)}}).on("click.wi","#Recuperar",async function(){n(this,!0,"Enviando");try{await L(u,await _(r("recEmail"))),c("✅ Email enviado, revisa tu bandeja","success"),setTimeout(()=>g("login"),2e3)}catch(i){c(v[i.code]||i.message,"error")}finally{n(this,!1)}}).on("click.wi",".tema",async function(){const i=$("wiSmile");i?.usuario&&setTimeout(async()=>{const a=localStorage.wiTema;if(a)try{await b(m(l,o.db,i.usuario),{tema:a,actualizado:y()},{merge:!0}),C("wiSmile",{...i,tema:a},24),c(`Tema ${a.split("|")[0]} guardado <i class="fas fa-check-circle"></i>`,"success")}catch(e){console.error("❌ tema:",e)}},0)});U(u,async i=>{if(!i)return E();const a=$("wiSmile");if(a)return h(a);const e=await f(m(l,o.db,i.displayName||i.email));e.exists()?h(e.data()):E()});export{u as auth,U as onAuthStateChanged,E as render,z as signOut};
