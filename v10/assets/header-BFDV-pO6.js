import{_ as x}from"./main-DTOxB6dq.js";import{j as e}from"./vendor-gzd0YkcT.js";import{h as U,e as v,M as f,d,i as g,f as L,j as D,r as N}from"./main-CYX6JOAB.js";import{db as h,auth as w}from"./firebase-DOPXtL1R.js";import{s as T,d as b,b as A,e as E,g as S,q as I,c as q,w as z,f as V,u as B,h as W,i as F,j as Q,k as X}from"./firebase-D7N42Z9V.js";const p={db:"smiles",rol:"smile"},k={"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña débil","auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Email no válido","auth/missing-email":"Usuario no registrado","auth/too-many-requests":"Demasiados intentos, espera"},$={regEmail:[a=>a.toLowerCase().trim(),a=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(a)||"Email inválido"],regUsuario:[a=>a.toLowerCase().replace(/[^a-z0-9_]/g,"").trim(),a=>a.length>=4||"Usuario 4-20 caracteres"],regNombre:[a=>a.trim(),a=>a.length>0||"Ingrese nombre"],regApellidos:[a=>a.trim(),a=>a.length>0||"Ingrese apellidos"],regPassword:[a=>a,a=>a.length>=6||"Mínimo 6 caracteres"],regPassword1:[a=>a,a=>a===e("#regPassword").val()||"No coinciden"]},l=(a,o,r,u,s)=>`<div class="au_grupo"><i class="fas fa-${a}"></i><input type="${o}" id="${r}" placeholder="${u}" required>${s?'<i class="fas fa-eye au_ojo"></i>':""}</div>`,_=(a,o,r,u="")=>`<div id="${a}" class="wiModal au_mod ${u}"><div class="modalBody"><button class="modalX">&times;</button><div class="au_main"><div class="au_logo">
   <img src="./smile.avif"></div><h2>${o}</h2><form id="${a.replace("Modal","Form")}">${r}</form></div></div></div>`,Y=[_("loginModal","Login",[l("envelope","text","email","Email o usuario"),l("lock","password","password","Contraseña",!0),'<button type="button" id="Login" class="au_btn inactivo">Iniciar Sesión</button>','<div class="au_links"><span class="olvidastePass">¿Olvidaste tu contraseña?</span><span class="crearCuenta">Crear cuenta</span></div>'].join("")),_("registroModal","Crear Cuenta",[l("envelope","email","regEmail","Email"),l("user","text","regUsuario","Usuario"),l("user-tie","text","regNombre","Nombre"),l("user-tie","text","regApellidos","Apellidos"),l("lock","password","regPassword","Contraseña",!0),l("lock","password","regPassword1","Confirmar",!0),'<div class="au_grupo au_check"><label><input type="checkbox" id="regTerminos" required><span>Acepto los <a href="/terminos.html" target="_blank">términos y condiciones</a></span></label></div>','<button type="button" id="Registrar" class="au_btn inactivo">Registrarme</button>','<div class="au_links"><span class="conCuenta">Ya tengo cuenta</span></div>'].join(""),"au_reg"),_("recuperarModal","Restablecer",["<p>Ingresa tu Email o usuario:</p>",l("envelope","text","recEmail","Email o usuario"),'<button type="button" id="Recuperar" class="au_btn inactivo">Enviar enlace</button>','<div class="au_links"><span class="volverLogin"><i class="fas fa-arrow-left"></i> Volver</span></div>'].join(""))];let M=!1;const Z=()=>{M||(e("body").append(Y.join("")),M=!0,H())},C=async a=>{if(a.includes("@"))return a;const o=await E(b(h,p.db,a));if(!o.exists())throw new Error("Usuario no encontrado");return o.data().email},G=a=>{if(!a)return;const[o,r]=a.split("|");document.documentElement.dataset.theme=o,e('meta[name="theme-color"]').attr("content",r),e(".tema").removeClass("mtha").filter(`[data-ths="${a}"]`).addClass("mtha")},j=async(a,o=24)=>{v.login(a,o),D()},c=a=>e(`#${a}`).val().trim(),H=()=>{let a=!1,o=!1,r=!1;e(document).on("click.wa",".au_ojo",function(){const s=e(this).siblings("input");s.attr("type",s.attr("type")==="password"?"text":"password"),e(this).toggleClass("fa-eye fa-eye-slash")}),e(document).on("input.wa","#regUsuario,#regEmail,#email,#recEmail",function(){e(this).val(e(this).val().toLowerCase())}),[["#password","#Login"],["#regPassword1","#Registrar"],["#recEmail","#Recuperar"]].forEach(([s,t])=>e(document).on("input.wa keyup.wa",s,i=>{e(t).removeClass("inactivo"),i.key==="Enter"&&e(t).click()})),Object.entries($).forEach(([s,[t,i]])=>e(document).on("blur.wa",`#${s}`,function(){const n=t(e(this).val());e(this).val(n);const m=i(n);m!==!0&&d(this,m,"error",2500)})),e(document).on("blur.wa","#regUsuario",async function(){const s=e(this).val().trim();if(s.includes("@"))return a=!1,d(this,"No puede contener @","error",2500);if(!(s.length<3))try{const t=(await E(b(h,p.db,s))).exists();a=!t,d(this,`Usuario ${t?'no disponible <i class="fas fa-times-circle"></i>':'disponible <i class="fas fa-circle-check"></i>'}`,t?"error":"success",3e3)}catch(t){console.error(t)}}),e(document).on("focus.wa","#email,#password",function(){d(this,e(this).attr("placeholder"))}),e(document).on("blur.wa","#regEmail",async function(){const s=e(this).val().trim();if(s.length>0&&!s.includes("@"))return o=!1,d(this,"Debe ser email válido","error",2500);if(!(s.length<3||!s.includes("@")))try{const t=!(await S(I(q(h,p.db),z("email","==",s)))).empty;o=!t,d(this,`Email ${t?'no disponible <i class="fas fa-times-circle"></i>':'disponible <i class="fas fa-circle-check"></i>'}`,t?"error":"success",3e3)}catch(t){console.error(t)}}),e(document).on("click.wa","#Registrar",async function(){if(r)return;if(!e("#regTerminos").is(":checked"))return d(e("#regTerminos")[0],"Acepta los términos","error",2500);r=!0,g(this,!0,"Registrando");const t=[[a,e("#regUsuario")[0],"Usuario no disponible"],[o,e("#regEmail")[0],"Email no disponible"],...Object.entries($).map(([i,[n,m]])=>{const y=m(n(e(`#${i}`).val()));return[y===!0,e(`#${i}`)[0],y!==!0?y:""]})].find(([i,,n])=>!i&&n);if(t){g(this,!1),d(t[1],t[2],"error",2500),t[1].focus(),r=!1;return}try{const i={email:c("regEmail"),usuario:c("regUsuario"),nombre:c("regNombre"),apellidos:c("regApellidos"),password:c("regPassword")},{user:n}=await V(w,i.email,i.password);await Promise.all([B(n,{displayName:i.usuario}),W(n)]);const m={usuario:i.usuario,email:i.email,nombre:i.nombre,apellidos:i.apellidos,rol:p.rol,uid:n.uid,terminos:!0,tema:localStorage.wiTema};await T(b(h,p.db,i.usuario),{...m,creado:A()}),await j(m)}catch(i){f(k[i.code]||i.message,"error")}finally{g(this,!1),r=!1}}),e(document).on("click.wa","#Login",async function(){g(this,!0,"Iniciando");try{await F(w,await C(c("email")),c("password"));const s=w.currentUser.displayName||c("email"),t=(await E(b(h,p.db,s))).data();t?.tema&&(localStorage.wiTema=t.tema,G(t.tema)),await j(t,450)}catch(s){f(k[s.code]||s.message,"error")}finally{g(this,!1)}}),e(document).on("click.wa","#Recuperar",async function(){g(this,!0,"Enviando");try{await Q(w,await C(c("recEmail"))),f("✅ Email enviado para restablecer","success")}catch(s){f(s.message||"Error al enviar","error")}finally{g(this,!1)}});const u={crearCuenta:["registroModal","loginModal"],conCuenta:["loginModal","registroModal"],olvidastePass:["recuperarModal","loginModal"],volverLogin:["loginModal","recuperarModal"]};e(document).on("click.wa",Object.keys(u).map(s=>"."+s).join(","),function(){const[s,t]=u[e(this).attr("class").split(" ")[0]];L(t),U(s)})};e(document).on("click.wa",".login,.registrar",function(a){a.preventDefault(),Z(),setTimeout(()=>U(e(this).hasClass("login")?"loginModal":"registroModal"),100)});e(document).on("click.wa",".tema",async function(){const a=localStorage.wiTema,o=v.user;if(o)try{await T(b(h,p.db,o.usuario),{tema:a,actualizado:A()},{merge:!0}),f(`Tema ${a.split("|")[0]} guardado`)}catch(r){console.error(r)}});const J=Object.freeze(Object.defineProperty({__proto__:null,auth:w,signOut:X},Symbol.toStringTag,{value:"Module"})),O=a=>{f("Bienvenido "+a.nombre),e(".wiauth").html(`
    <a href="/smile" class="nv_item" data-page="smile"><i class="fa-solid fa-gauge"></i> <span>Dashboard</span></a>
    <div class="sesion"><img src="${a.imagen||"./smile.avif"}" alt="${a.nombre}"><span>${a.nombre}</span></div>
    <button class="wibtn_auth bt_salir"><i class="fas fa-sign-out-alt"></i> Salir</button>
  `)},R=()=>{e(".wiauth").html(`
    <button class="wibtn_auth registrar"><i class="fas fa-user-plus"></i><span>Registrar</span></button>
    <button class="wibtn_auth login"><i class="fas fa-sign-in-alt"></i><span>Login</span></button>
  `)};v.on(a=>a?O(a):(R(),N.navigate("/")));const P=v.user;P?O(P):R();e(document).on("click.wi",".bt_salir",async()=>{const{auth:a,signOut:o}=await x(async()=>{const{auth:r,signOut:u}=await Promise.resolve().then(()=>J);return{auth:r,signOut:u}},void 0);await o(a),v.logout()});export{O as personal};
